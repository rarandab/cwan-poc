AWS CLOUD WAN POC - ARCHITECTURE DIAGRAM
=====================================

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                     │
│  ON-PREMISES / SD-WAN                    AWS CLOUD WAN CORE NETWORK                           REGIONAL VPCs                         │
│                                                                                                                                     │
│  ┌──────────────────┐                    ┌────────────────────────────────────────────┐                                             │
│  │                  │                    │                                            │      ┌─────────────────────────────────┐    │
│  │   SD-WAN / VPN   │                    │        AWS Cloud WAN                       │      │  Region: eu-central-1           │    │
│  │                  │    BGP Peering     │        Global Network                      │      │  (10.0.0.0/16)                  │    │
│  │  FRRouting BGP   │◄──────────────────►│        ASN: 65000-65100                    │      │                                 │    │
│  │  ASN: 64600      │  Connect Tunnel-   │        Inside: 192.168.0.0/16              │      │  ┌──────────────────────────┐   │    │
│  │                  │  Less (NO_ENCAP)   │                                            │      │  │ Inspection Layer         │   │    │
│  │  Announces:      │                    │  ┌──────────────────────────────────────┐  │      │  │ ┌──────────┐ ┌─────────┐ │   │    │
│  │  172.16.0.0/16   │                    │  │                                      │  │      │  │ │ NFG VPC  │ │ NFW VPC │ │   │    │
│  │  172.18.0.0/16   │                    │  │      NETWORK SEGMENTS                │  │      │  │ │100.64.0.0│ │10.0.255 │ │   │    │
│  │  172.20.0.0/16   │                    │  │                                      │  │      │  │ │   /20    │ │  .0/24  │ │   │    │
│  │                  │                    │  │  ┌────────────┐  ┌────────────┐      │  │      │  │ │Appliance │ │Net FW + │ │   │    │
│  └──────────────────┘                    │  │  │Production  │  │Non-Prod    │      │  │      │  │ │  Mode    │ │  GWLB   │ │   │    │
│                                          │  │  │  (pro)     │  │  (npd)     │      │  │      │  │ └──────────┘ └─────────┘ │   │    │
│                                          │  │  │ Isolated   │  │ Isolated   │      │  │      │  └──────────────────────────┘   │    │
│                                          │  │  └────────────┘  └────────────┘      │  │      │                                 │    │
│                                          │  │                                      │  │      │  ┌──────────────────────────┐   │    │
│                                          │  │  ┌────────────┐  ┌────────────┐      │  │      │  │ Shared Services          │   │    │
│                                          │  │  │  Shared    │  │    NVA     │      │  │      │  │ ┌──────────────────────┐ │   │    │
│                                          │  │  │ Services   │  │ Inspection │      │  │      │  │ │ Shared VPC           │ │   │    │
│                                          │  │  │   (shr)    │  │   (nva)    │      │  │      │  │ │ 10.0.250.0/24        │ │   │    │
│                                          │  │  │Shared w/all│  │            │      │  │      │  │ │ - VPC Endpoints (S3) │ │   │    │
│                                          │  │  └────────────┘  └────────────┘      │  │      │  │ │ - Route53 Resolver   │ │   │    │
│                                          │  │                                      │  │      │  │ └──────────────────────┘ │   │    │
│                                          │  │  ┌────────────┐                      │  │      │  └──────────────────────────┘   │    │
│                                          │  │  │  Hybrid    │                      │  │      │                                 │    │
│                                          │  │  │   (hyb)    │                      │  │      │  ┌──────────────────────────┐   │    │
│                                          │  │  │ SD-WAN/VPN │                      │  │      │  │ SD-WAN                   │   │    │
│                                          │  │  └────────────┘                      │  │      │  │ ┌──────────────────────┐ │   │    │
│                                          │  │                                      │  │      │  │ │ SD-WAN VPC           │ │   │    │
│                                          │  └──────────────────────────────────────┘  │      │  │ │ 10.0.254.0/24        │ │   │    │
│                                          │                                            │      │  │ │ Connect Tunnel-Less  │ │   │    │
│                                          │  ┌──────────────────────────────────────┐  │      │  │ └──────────────────────┘ │   │    │
│                                          │  │                                      │  │      │  └──────────────────────────┘   │    │
│                                          │  │   NETWORK FUNCTION GROUP (NFG)       │  │      │                                 │    │
│                                          │  │                                      │  │      │  ┌──────────────────────────┐   │    │
│                                          │  │   ┌──────────────────────────┐       │  │      │  │ Workloads                │   │    │
│                                          │  │   │  Inspection NFG          │       │  │      │  │ ┌──────────┐ ┌─────────┐ │   │    │
│                                          │  │   │  Service Insertion       │       │  │      │  │ │ Pro VPC  │ │ Dev VPC │ │   │    │
│                                          │  │   │  (send-via policy)       │◄──────┼──┼──────┼──┤ │10.0.0.0  │ │10.0.64  │ │   │    │
│                                          │  │   └──────────────────────────┘       │  │      │  │ │  /24     │ │  .0/24  │ │   │    │
│                                          │  │                                      │  │      │  │ │+ 2nd CIDR│ │+ 2nd    │ │   │    │
│                                          │  └──────────────────────────────────────┘  │      │  │ └──────────┘ └─────────┘ │   │    │
│                                          │                                            │      │  └──────────────────────────┘   │    │
│                                          └────────────────────────────────────────────┘      └─────────────────────────────────┘    │
│                                                                                                                                     │
│                                                                                              ┌─────────────────────────────────┐    │
│                                                                                              │  Region: eu-south-2             │    │
│                                                                                              │  (10.1.0.0/16)                  │    │
│                                                                                              │  - Inspection Layer             │    │
│                                                                                              │  - Shared Services              │    │
│                                                                                              │  - Workloads (Pro + Dev)        │    │
│                                                                                              └─────────────────────────────────┘    │
│                                                                                                                                     │
│                                                                                              ┌─────────────────────────────────┐    │
│                                                                                              │  Region: eu-south-1             │    │
│                                                                                              │  (10.2.0.0/16)                  │    │
│                                                                                              │  - Shared Services              │    │
│                                                                                              │  - Workloads (Dev)              │    │
│                                                                                              └─────────────────────────────────┘    │
│                                                                                                                                     │
│                                                                                              ┌─────────────────────────────────┐    │
│                                                                                              │  Region: eu-west-1              │    │
│                                                                                              │  (10.3.0.0/16)                  │    │
│                                                                                              │  - Shared Services              │    │
│                                                                                              │  - Workloads (Dev)              │    │
│                                                                                              └─────────────────────────────────┘    │
│                                                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

TRAFFIC FLOWS
=============

1. SD-WAN to Cloud:
   On-Premises ──[BGP]──> SD-WAN VPC ──[Connect Tunnel-Less]──> Hybrid Segment ──[Inspection]──> Other Segments

2. Inter-Segment Traffic:
   Production VPC ──> Production Segment ──[send-via]──> Inspection NFG ──> NFG VPC ──[GWLB]──> Network Firewall
   ──> NFG VPC ──> Cloud WAN ──> Non-Production Segment ──> Dev VPC

3. Shared Services Access:
   Any VPC ──> Cloud WAN ──> Shared Services Segment ──> Shared VPC ──> VPC Endpoints / Route53

4. Cross-Region:
   VPC (eu-central-1) ──> Cloud WAN ──[Inspection]──> Cloud WAN ──> VPC (eu-south-2)

ROUTING POLICIES
================

Applied to VPC Attachments:
├─ secondaryCidrFiltering: Blocks 100.64.0.0/10

Applied to Hybrid Attachments:
├─ summarizeCloud: Aggregates 10.x.0.0/16 per region
├─ blockSDWanTransit: Blocks SD-WAN VPC CIDRs (10.x.254.0/24)
└─ blockInsideCidrs: Blocks 192.168.0.0/16

SEGMENT RELATIONSHIPS
=====================

Production (pro)     ──[Isolated]──     No direct access to other segments
                     ──[Inspected]──>   All traffic via NFG
                     ──[Access]──>      Shared Services

Non-Production (npd) ──[Isolated]──     No direct access to other segments
                     ──[Inspected]──>   All traffic via NFG
                     ──[Access]──>      Shared Services

Shared Services (shr)──[Shared]──>      Accessible from all segments
                     ──[No Inspection]─ Direct access

Hybrid (hyb)         ──[Inspected]──>   All traffic via NFG
                     ──[Access]──>      Shared Services, NVA

NVA (nva)            ──[Inspection]──   Hosts Network Firewall VPCs
                     ──[No Isolation]─  Accessible from Hybrid

KEY FEATURES
============

✓ Multi-Region: 4 AWS regions (eu-central-1, eu-south-2, eu-south-1, eu-west-1)
✓ Segment Isolation: Production and Non-Production fully isolated
✓ Centralized Inspection: All inter-segment traffic inspected via NFG
✓ SD-WAN Integration: Connect Tunnel-Less with BGP (no GRE tunnels)
✓ Shared Services: Centralized VPC Endpoints and DNS resolution
✓ High Availability: Multi-AZ deployment, redundant BGP peers
✓ Advanced Routing: CIDR filtering, summarization, transit blocking
✓ DNS Resolution: Route 53 Resolver with cross-region forwarding

CIDR ALLOCATION
===============

Regional CIDRs:
├─ eu-central-1: 10.0.0.0/16
├─ eu-south-2:   10.1.0.0/16
├─ eu-south-1:   10.2.0.0/16
└─ eu-west-1:    10.3.0.0/16

Per-Region Allocation:
├─ Inspection VPCs:    100.64.0.0/20 (non-routable, shared across regions)
├─ Network Firewall:   10.x.255.0/24
├─ Shared Services:    10.x.250.0/24
├─ SD-WAN:             10.x.254.0/24
└─ Workloads:          10.x.0.0/24, 10.x.64.0/24, etc.

Secondary CIDRs:
└─ Workload Data Tier: 100.64.100.0/22 (non-routable)

On-Premises:
├─ SD-WAN Announced:   172.16.0.0/16, 172.18.0.0/16, 172.20.0.0/16
└─ VPN Additional:     172.20.0.0/16, 172.21.0.0/16, 172.22.0.0/16

Cloud WAN Internal:
└─ Inside CIDRs:       192.168.0.0/16
